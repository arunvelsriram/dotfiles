#!/bin/bash

DIRS_AND_FILES=(bashrc bash_profile profile zshrc gitconfig gemrc vimrc oh-my-zsh/custom/aliases.zsh oh-my-zsh/custom/tw_digital.zsh oh-my-zsh/custom/themes)
BACKUP_DIR=~/dotfiles.backup.`date +%-H-%M-%S-%F`

create_directories() {
  mkdir -p $BACKUP_DIR
  mkdir -p $BACKUP_DIR/oh-my-zsh/custom
}

backup() {
  for dir_or_file in ${DIRS_AND_FILES[@]}; do
    full_path=~/.$dir_or_file
    if [[ -f $full_path ]]; then
      cp $full_path $BACKUP_DIR/$dir_or_file
    elif [[ -d $full_path ]]; then
      mkdir -p $full_path
      cp -R $full_path/ $BACKUP_DIR/$dir_or_file
    fi
  done

  echo Copied existing files to $BACKUP_DIR
  echo
}

setup() {
  for dir_or_file in ${DIRS_AND_FILES[@]}; do
    full_path=~/.$dir_or_file
    [ -f $full_path ] && rm $full_path
    [ -d $full_path ] && rm -rf $full_path
    ln -sv ~/dotfiles/$dir_or_file $full_path
  done
}

create_directories
backup
setup